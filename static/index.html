<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude History Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #1f2937; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .message-content { white-space: pre-wrap; word-break: break-word; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="gradient-bg shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                    </svg>
                    <h1 class="text-2xl font-bold text-white">Claude History Viewer</h1>
                </div>
                <div class="flex space-x-4">
                    <button onclick="showTab('projects')" id="tab-projects" class="tab-btn px-4 py-2 rounded-lg bg-white/20 text-white hover:bg-white/30 transition">
                        é¡¹ç›®åˆ—è¡¨
                    </button>
                    <button onclick="showTab('statistics')" id="tab-statistics" class="tab-btn px-4 py-2 rounded-lg text-white/80 hover:bg-white/20 transition">
                        æ•°æ®åˆ†æ
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- é¡¹ç›®åˆ—è¡¨è§†å›¾ -->
        <div id="view-projects" class="fade-in">
            <div class="grid grid-cols-12 gap-6">
                <!-- å·¦ä¾§ï¼šé¡¹ç›®åˆ—è¡¨ -->
                <div class="col-span-3">
                    <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden">
                        <div class="p-4 border-b border-gray-700">
                            <h2 class="text-lg font-semibold flex items-center">
                                <svg class="w-5 h-5 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                                </svg>
                                é¡¹ç›®
                            </h2>
                        </div>
                        <div id="project-list" class="max-h-[calc(100vh-250px)] overflow-y-auto scrollbar-thin">
                            <div class="p-4 text-center text-gray-500">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>

                <!-- ä¸­é—´ï¼šä¼šè¯åˆ—è¡¨ -->
                <div class="col-span-3">
                    <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden">
                        <div class="p-4 border-b border-gray-700">
                            <h2 class="text-lg font-semibold flex items-center">
                                <svg class="w-5 h-5 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"></path>
                                </svg>
                                ä¼šè¯
                            </h2>
                        </div>
                        <div id="session-list" class="max-h-[calc(100vh-250px)] overflow-y-auto scrollbar-thin">
                            <div class="p-4 text-center text-gray-500">è¯·é€‰æ‹©ä¸€ä¸ªé¡¹ç›®</div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šæ¶ˆæ¯è¯¦æƒ… -->
                <div class="col-span-6">
                    <div class="bg-gray-800 rounded-xl shadow-xl overflow-hidden">
                        <div class="p-4 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                    </svg>
                                    å¯¹è¯å†…å®¹
                                </h2>
                                <div id="source-file-info" class="hidden">
                                    <button onclick="openSourceFile()" class="flex items-center text-xs text-blue-400 hover:text-blue-300 transition">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                        <span id="source-file-path" class="truncate max-w-xs" title=""></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="message-list" class="max-h-[calc(100vh-250px)] overflow-y-auto scrollbar-thin p-4">
                            <div class="text-center text-gray-500">è¯·é€‰æ‹©ä¸€ä¸ªä¼šè¯æŸ¥çœ‹å¯¹è¯å†…å®¹</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡åˆ†æè§†å›¾ -->
        <div id="view-statistics" class="hidden fade-in">
            <!-- æ¦‚è§ˆå¡ç‰‡ -->
            <div class="grid grid-cols-4 gap-6 mb-6">
                <div class="bg-gradient-to-br from-purple-600 to-purple-800 rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-200 text-sm">æ€»é¡¹ç›®æ•°</p>
                            <p id="stat-projects" class="text-3xl font-bold mt-1">-</p>
                        </div>
                        <svg class="w-12 h-12 text-purple-300/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                        </svg>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-200 text-sm">æ€»ä¼šè¯æ•°</p>
                            <p id="stat-sessions" class="text-3xl font-bold mt-1">-</p>
                        </div>
                        <svg class="w-12 h-12 text-blue-300/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"></path>
                        </svg>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-green-600 to-green-800 rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-200 text-sm">æ€»æ¶ˆæ¯æ•°</p>
                            <p id="stat-messages" class="text-3xl font-bold mt-1">-</p>
                        </div>
                        <svg class="w-12 h-12 text-green-300/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                        </svg>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-orange-600 to-orange-800 rounded-xl p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-200 text-sm">å†å²è®°å½•</p>
                            <p id="stat-history" class="text-3xl font-bold mt-1">-</p>
                        </div>
                        <svg class="w-12 h-12 text-orange-300/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- å›¾è¡¨åŒºåŸŸ -->
            <div class="grid grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-800 rounded-xl p-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        æ¯æ—¥æ´»åŠ¨è¶‹åŠ¿
                    </h3>
                    <canvas id="chart-daily"></canvas>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        æ¯å°æ—¶æ´»åŠ¨åˆ†å¸ƒ
                    </h3>
                    <canvas id="chart-hourly"></canvas>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <div class="bg-gray-800 rounded-xl p-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                        </svg>
                        å·¥å…·ä½¿ç”¨ç»Ÿè®¡
                    </h3>
                    <canvas id="chart-tools"></canvas>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                        </svg>
                        é¡¹ç›®æ´»è·ƒåº¦ Top 10
                    </h3>
                    <canvas id="chart-projects"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentProjectId = null;
        let currentSessionId = null;
        let currentSourceFile = null;
        let charts = {};

        // æ ¼å¼åŒ–æ—¶é—´æˆ³
        function formatTimestamp(ts) {
            if (!ts) return '-';
            const date = new Date(ts);
            return date.toLocaleString('zh-CN');
        }

        // æˆªæ–­æ–‡æœ¬
        function truncate(text, maxLength = 50) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // è½¬ä¹‰HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ‰“å¼€æºæ–‡ä»¶
        function openSourceFile() {
            if (currentSourceFile) {
                // å¤åˆ¶è·¯å¾„åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(currentSourceFile).then(() => {
                    alert('æºæ–‡ä»¶è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿:\n' + currentSourceFile);
                }).catch(() => {
                    prompt('æºæ–‡ä»¶è·¯å¾„:', currentSourceFile);
                });
            }
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-white/20');
                btn.classList.add('text-white/80');
            });
            document.getElementById(`tab-${tab}`).classList.add('bg-white/20');
            document.getElementById(`tab-${tab}`).classList.remove('text-white/80');

            document.getElementById('view-projects').classList.add('hidden');
            document.getElementById('view-statistics').classList.add('hidden');
            document.getElementById(`view-${tab}`).classList.remove('hidden');

            if (tab === 'statistics') {
                loadStatistics();
            }
        }

        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        async function loadProjects() {
            try {
                const response = await fetch('/api/projects');
                const projects = await response.json();

                const container = document.getElementById('project-list');
                if (projects.length === 0) {
                    container.innerHTML = '<div class="p-4 text-center text-gray-500">æš‚æ— é¡¹ç›®</div>';
                    return;
                }

                container.innerHTML = projects.map(project => `
                    <div class="p-3 border-b border-gray-700 hover:bg-gray-700/50 cursor-pointer transition"
                         onclick="loadSessions('${project.id}')">
                        <div class="font-medium text-sm truncate" title="${escapeHtml(project.name)}">
                            ${escapeHtml(truncate(project.name, 30))}
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                            ${project.session_count} ä¸ªä¼šè¯
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                document.getElementById('project-list').innerHTML =
                    '<div class="p-4 text-center text-red-400">åŠ è½½å¤±è´¥</div>';
            }
        }

        // åŠ è½½ä¼šè¯åˆ—è¡¨
        async function loadSessions(projectId) {
            currentProjectId = projectId;
            currentSessionId = null;

            document.getElementById('message-list').innerHTML =
                '<div class="text-center text-gray-500">è¯·é€‰æ‹©ä¸€ä¸ªä¼šè¯æŸ¥çœ‹å¯¹è¯å†…å®¹</div>';

            try {
                const response = await fetch(`/api/projects/${projectId}/sessions`);
                const sessions = await response.json();

                const container = document.getElementById('session-list');
                if (sessions.length === 0) {
                    container.innerHTML = '<div class="p-4 text-center text-gray-500">æš‚æ— ä¼šè¯</div>';
                    return;
                }

                container.innerHTML = sessions.map(session => `
                    <div class="p-3 border-b border-gray-700 hover:bg-gray-700/50 cursor-pointer transition"
                         onclick="loadMessages('${projectId}', '${session.id}')">
                        <div class="font-medium text-sm truncate text-blue-400">
                            ${session.id.substring(0, 8)}...
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                            ${session.message_count} æ¡æ¶ˆæ¯
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            ${formatTimestamp(session.last_timestamp)}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('åŠ è½½ä¼šè¯å¤±è´¥:', error);
                document.getElementById('session-list').innerHTML =
                    '<div class="p-4 text-center text-red-400">åŠ è½½å¤±è´¥</div>';
            }
        }

        // åŠ è½½æ¶ˆæ¯åˆ—è¡¨
        async function loadMessages(projectId, sessionId) {
            currentSessionId = sessionId;

            try {
                const response = await fetch(`/api/projects/${projectId}/sessions/${sessionId}`);
                const data = await response.json();
                const messages = data.messages || [];

                // æ›´æ–°æºæ–‡ä»¶ä¿¡æ¯
                currentSourceFile = data.source_file;
                const sourceFileInfo = document.getElementById('source-file-info');
                const sourceFilePath = document.getElementById('source-file-path');
                if (currentSourceFile) {
                    sourceFileInfo.classList.remove('hidden');
                    sourceFilePath.textContent = truncate(currentSourceFile, 40);
                    sourceFilePath.title = currentSourceFile;
                } else {
                    sourceFileInfo.classList.add('hidden');
                }

                const container = document.getElementById('message-list');
                if (messages.length === 0) {
                    container.innerHTML = '<div class="text-center text-gray-500">æš‚æ— æ¶ˆæ¯</div>';
                    return;
                }

                container.innerHTML = messages.map(msg => `
                    <div class="mb-4 fade-in ${msg.type === 'user' ? 'ml-8' : 'mr-8'}">
                        <div class="flex items-center mb-1 flex-wrap gap-1">
                            <span class="text-xs font-medium ${msg.type === 'user' ? 'text-blue-400' : 'text-green-400'}">
                                ${msg.type === 'user' ? 'ç”¨æˆ·' : 'Claude'}
                            </span>
                            ${msg.model ? `<span class="text-xs text-purple-400 bg-purple-900/30 px-1.5 py-0.5 rounded">${escapeHtml(msg.model)}</span>` : ''}
                            <span class="text-xs text-gray-500 ml-2">
                                ${formatTimestamp(msg.timestamp)}
                            </span>
                            ${msg.cwd ? `<span class="text-xs text-gray-600 ml-2" title="${escapeHtml(msg.cwd)}">ğŸ“ ${escapeHtml(truncate(msg.cwd, 30))}</span>` : ''}
                        </div>
                        <div class="p-3 rounded-lg ${msg.type === 'user' ? 'bg-blue-900/30 border border-blue-800' : 'bg-gray-700/50 border border-gray-600'}">
                            <div class="message-content text-sm">${escapeHtml(msg.content)}</div>
                        </div>
                    </div>
                `).join('');

                container.scrollTop = 0;
            } catch (error) {
                console.error('åŠ è½½æ¶ˆæ¯å¤±è´¥:', error);
                document.getElementById('message-list').innerHTML =
                    '<div class="text-center text-red-400">åŠ è½½å¤±è´¥</div>';
            }
        }

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStatistics() {
            try {
                const response = await fetch('/api/statistics');
                const stats = await response.json();

                // æ›´æ–°æ¦‚è§ˆæ•°å­—
                document.getElementById('stat-projects').textContent = stats.total_projects;
                document.getElementById('stat-sessions').textContent = stats.total_sessions;
                document.getElementById('stat-messages').textContent = stats.total_messages;
                document.getElementById('stat-history').textContent = stats.total_history_entries;

                // ç»˜åˆ¶å›¾è¡¨
                renderDailyChart(stats.daily_activity);
                renderHourlyChart(stats.hourly_activity);
                renderToolsChart(stats.tool_usage);
                renderProjectsChart(stats.projects_by_activity);
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            }
        }

        // ç»˜åˆ¶æ¯æ—¥æ´»åŠ¨å›¾è¡¨
        function renderDailyChart(data) {
            const ctx = document.getElementById('chart-daily').getContext('2d');
            if (charts.daily) charts.daily.destroy();

            charts.daily = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'æ´»åŠ¨æ¬¡æ•°',
                        data: Object.values(data),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } },
                        y: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
        }

        // ç»˜åˆ¶æ¯å°æ—¶æ´»åŠ¨å›¾è¡¨
        function renderHourlyChart(data) {
            const ctx = document.getElementById('chart-hourly').getContext('2d');
            if (charts.hourly) charts.hourly.destroy();

            const labels = Array.from({length: 24}, (_, i) => `${i}:00`);
            const values = labels.map((_, i) => data[i] || 0);

            charts.hourly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ´»åŠ¨æ¬¡æ•°',
                        data: values,
                        backgroundColor: '#8b5cf6'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } },
                        y: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
        }

        // ç»˜åˆ¶å·¥å…·ä½¿ç”¨å›¾è¡¨
        function renderToolsChart(data) {
            const ctx = document.getElementById('chart-tools').getContext('2d');
            if (charts.tools) charts.tools.destroy();

            const entries = Object.entries(data).slice(0, 10);
            charts.tools = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: entries.map(e => e[0]),
                    datasets: [{
                        data: entries.map(e => e[1]),
                        backgroundColor: [
                            '#ef4444', '#f97316', '#eab308', '#22c55e', '#14b8a6',
                            '#3b82f6', '#6366f1', '#8b5cf6', '#ec4899', '#f43f5e'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#9ca3af' }
                        }
                    }
                }
            });
        }

        // ç»˜åˆ¶é¡¹ç›®æ´»è·ƒåº¦å›¾è¡¨
        function renderProjectsChart(data) {
            const ctx = document.getElementById('chart-projects').getContext('2d');
            if (charts.projects) charts.projects.destroy();

            charts.projects = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(p => truncate(p.name, 20)),
                    datasets: [{
                        label: 'æ¶ˆæ¯æ•°',
                        data: data.map(p => p.messages),
                        backgroundColor: '#f97316'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } },
                        y: { grid: { color: '#374151' }, ticks: { color: '#9ca3af' } }
                    }
                }
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadProjects();
        });
    </script>
</body>
</html>
